# UserParameter для виджетов дашборда. Вывод — читаемый список (имя, ID, статус), не JSON.
# Требуется jq в образе агента (Dockerfile.agent2).
UserParameter=docker.containers.running.list,curl -s --unix-socket /var/run/docker.sock "http://localhost/containers/json" 2>/dev/null | jq -r '( ["Запущено: " + (length|tostring) + " контейнер(ов)", "Имя\tID\tСтатус"] | .[] ), (.[] | ((.Names[0] // "?") | ltrimstr("/")) + "\t" + (.Id[0:12]) + "\t" + (.Status))' 2>/dev/null | head -c 65535 || echo "Ошибка: jq в образ агента"
UserParameter=docker.containers.exited.list,curl -s --unix-socket /var/run/docker.sock "http://localhost/containers/json?all=true&filters=%7B%22status%22%3A%5B%22exited%22%5D%7D" 2>/dev/null | jq -r '( ["Exited (имя, ID, когда завершён):"] | .[] ), (.[] | ((.Names[0] // "?") | ltrimstr("/")) + "\t" + (.Id[0:12]) + "\t" + (.Status))' 2>/dev/null | head -c 65535 || echo "Ошибка: jq"
UserParameter=docker.swarm.state,curl -s --unix-socket /var/run/docker.sock "http://localhost/info" 2>/dev/null | grep -o '"LocalNodeState":"[^"]*"' | head -1 | cut -d'"' -f4 || true
# Сводка по диску: свободно X из Y (ключ без запятой — в UserParameter запятая разделяет ключ и команду)
UserParameter=hostfs.disk.summary,df -B1 /hostfs 2>/dev/null | awk 'NR==2{free=$4; total=$2; pct=$5; gsub(/%/,"",pct); free_pct=100-pct; printf "%.1f%% свободно\n%.1f GB из %.1f GB", free_pct, free/1024/1024/1024, total/1024/1024/1024}' || echo "N/A"
